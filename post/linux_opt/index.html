<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.24.1" />



<link rel="canonical" href="http://kingjcy.github.io/post/linux_opt/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>linux操作命令 - kingjcy Blog</title>
    
<meta name="description" content="&lt;p&gt;一些linux常用的的操作命令，记录备忘也便于使用时查看。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;">

<meta property="og:title" content="linux操作命令 - kingjcy Blog">
<meta property="og:type" content="article">
<meta property="og:url" content="http://kingjcy.github.io/post/linux_opt/">
<meta property="og:image" content="http://kingjcy.github.ioimages/default.png">
<meta property="og:site_name" content="kingjcy Blog">
<meta property="og:description" content="&lt;p&gt;一些linux常用的的操作命令，记录备忘也便于使用时查看。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="kingjcy Blog">
<meta name="twitter:url" content="http://kingjcy.github.io/post/linux_opt/">
<meta name="twitter:title" content="linux操作命令 - kingjcy Blog">
<meta name="twitter:description" content="&lt;p&gt;一些linux常用的的操作命令，记录备忘也便于使用时查看。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;">
<meta name="twitter:image" content="http://kingjcy.github.ioimages/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"http://kingjcy.github.io"
    },
    "headline": "linux操作命令 - kingjcy Blog",
    "image": {
      "@type": "ImageObject",
      "url": "http://kingjcy.github.ioimages/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2015-02-23T11:20:38JST",
    "dateModified": "2015-02-23T11:20:38JST",
    "author": {
      "@type": "Person",
      "name": "kingjcy Blog"
    },
    "publisher": {
      "@type": "Organization",
      "name": "kingjcy Blog",
      "logo": {
        "@type": "ImageObject",
        "url": "http://kingjcy.github.ioimages/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "<p>一些linux常用的的操作命令，记录备忘也便于使用时查看。</p>

<p></p>"
  }
</script>


    <link href="http://kingjcy.github.iocss/styles.css" rel="stylesheet">
  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://kingjcy.github.io">kingjcy Blog</a>
          </div>

          
          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="http://kingjcy.github.io/post/">归档</a></li>
              
              
              
              <li><a href="http://kingjcy.github.io/about/">关于我</a></li>
              
              
            </ul>
            
          </div>
          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="http://kingjcy.github.io"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://kingjcy.github.iopost/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li class="active">linux操作命令</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2015-02-23T11:20:38JST">Feb 23, 2015</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://kingjcy.github.iopost/">post</a></li>
      
    </ul>

    <h1 class="title">linux操作命令</h1>
  </header>

  

  <div class="article-body"><p>一些linux常用的的操作命令，记录备忘也便于使用时查看。</p>

<p></p>

<h3 id="tar">tar</h3>

<p>-c: 建立压缩档案
-x：解压
-t：查看内容
-r：向压缩归档文件末尾追加文件
-u：更新原压缩包中的文件</p>

<p>这五个是独立的命令，压缩解压都要用到其中一个，可以和别的命令连用但只能用其中一个。下面的参数是根据需要在压缩或解压档案时可选的。</p>

<p>-z：有gzip属性的
-j：有bz2属性的
-Z：有compress属性的
-v：显示所有过程
-O：将文件解开到标准输出</p>

<p>下面的参数-f是必须的</p>

<p>-f: 使用档案名字，切记，这个参数是最后一个参数，后面只能接档案名。</p>

<p>tar -cf all.tar *.jpg
这条命令是将所有.jpg的文件打成一个名为all.tar的包。-c是表示产生新的包，-f指定包的文件名。</p>

<p>tar -rf all.tar *.gif
这条命令是将所有.gif的文件增加到all.tar的包里面去。-r是表示增加文件的意思。</p>

<p>tar -uf all.tar logo.gif
这条命令是更新原来tar包all.tar中logo.gif文件，-u是表示更新文件的意思。</p>

<p>tar -tf all.tar
这条命令是列出all.tar包中所有文件，-t是列出文件的意思</p>

<p>tar -xf all.tar
这条命令是解出all.tar包中所有文件，-t是解开的意思</p>

<p>压缩</p>

<p>tar -cvf jpg.tar *.jpg //将目录里所有jpg文件打包成tar.jpg</p>

<p>tar -czf jpg.tar.gz *.jpg   //将目录里所有jpg文件打包成jpg.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为jpg.tar.gz</p>

<p>tar -cjf jpg.tar.bz2 *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2</p>

<p>tar -cZf jpg.tar.Z *.jpg   //将目录里所有jpg文件打包成jpg.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z</p>

<p>rar a jpg.rar *.jpg //rar格式的压缩，需要先下载rar for linux</p>

<p>zip jpg.zip *.jpg //zip格式的压缩，需要先下载zip for linux</p>

<p>解压</p>

<p>tar -xvf file.tar //解压 tar包</p>

<p>tar -xzvf file.tar.gz //解压tar.gz</p>

<p>tar -xjvf file.tar.bz2   //解压 tar.bz2</p>

<p>tar -xZvf file.tar.Z   //解压tar.Z</p>

<p>unrar e file.rar //解压rar</p>

<p>unzip file.zip //解压zip</p>

<p>总结</p>

<p>1、*.tar 用 tar -xvf 解压</p>

<p>2、*.gz 用 gzip -d或者gunzip 解压</p>

<p>3、<em>.tar.gz和</em>.tgz 用 tar -xzf 解压</p>

<p>4、*.bz2 用 bzip2 -d或者用bunzip2 解压</p>

<p>5、*.tar.bz2用tar -xjf 解压</p>

<p>6、*.Z 用 uncompress 解压</p>

<p>7、*.tar.Z 用tar -xZf 解压</p>

<p>8、*.rar 用 unrar e解压</p>

<p>9、*.zip 用 unzip 解压</p>

<h3 id="grep">grep</h3>

<p>Grep 命令</p>

<p>1、 参数：</p>

<pre><code>-I ：忽略大小写 
-c ：打印匹配的行数 
-l ：从多个文件中查找包含匹配项 
-v ：查找不包含匹配项的行 
-n：打印包含匹配项的行和行标,cat也有这个作用 
-E:相当于egrep，深度匹配，多重匹配，比如egrep &quot;a|b&quot; filenamea|b
</code></pre>

<p>2、RE（正则表达式）</p>

<pre><code>\ 忽略正则表达式中特殊字符的原有含义 
^ 匹配正则表达式的开始行 
$ 匹配正则表达式的结束行 
\&lt; 从匹配正则表达式的行开始 
\&gt; 到匹配正则表达式的行结束 
[ ] 单个字符；如[A] 即A符合要求 
[ - ] 范围 ；如[A-Z]即A，B，C一直到Z都符合要求 
. 所有的单个字符 
* 所有字符，长度可以为0 
</code></pre>

<h3 id="usermod">usermod</h3>

<p>usermod -d /disk01/svn/jiangchunyin jiangchunyin  改变家目录</p>

<h3 id="du">du</h3>

<p>du -ks * |sort -n    按大小排序</p>

<h3 id="echo">echo</h3>

<p>echo $?     打印终止状态（进程）</p>

<h3 id="find-grep">find&amp;grep</h3>

<p>查找当前目录下所有cpp文件中含有getUserProduct的地方</p>

<pre><code>find ./ -name &quot;*.cpp&quot; -print | xargs grep getUserProduct    -----xargs也是一种承接，一般不用于cp，mv，和-exec差不多
grep -n &quot;sCrmOrgId&quot; $(find . -name &quot;*.cpp&quot;)

find . -maxdepth 1 -type f -name &quot;&quot; -mtime -1 -exec rm -rf {} \      ----maxdepth 1 目录深度，这个就是一级，-type f表示只是找文件，-mtime -1当前一天的文件，表示多长时间的文件，-表示多少天以内的，+表示多少天以前的，比如三十天以前的-mtime +30 。-exec rm -rf {} \ 执行命令，{}表示前面的结果，最后又一个\是格式
find . -maxdepth 1 -type f -name &quot;&quot; -mtime +30 -exec cp  {} /tmp \      

find . -size +50M 大于五十M的
</code></pre>

<h3 id="sudo">sudo</h3>

<p>编辑/etc/sudoers文件。也就是输入命令&rdquo;vim /etc/sudoers&rdquo;,进入编辑模式，找到这一 行：&rdquo;root ALL=(ALL) ALL&rdquo;在起下面添加&rdquo;xxx ALL=(ALL) ALL&rdquo;(这里的xxx是你的用户名)，然后保存退出。可以让普通 用户执行以下只有root用户执行的操作。避免总是用su - 用户切换</p>

<h3 id="目录">目录</h3>

<pre><code>linux根目录下各文件夹的作用

 /bin 二进制可执行命令   
 /dev 设备特殊文件   
 /etc 系统管理和配置文件   
 /etc/rc.d 启动的配置文件和脚本   
 /home 用户主目录的基点，比如用户user的主目录就是/home/user，可以用~user表示   
 /lib 标准程序设计库，又叫动态链接共享库，作用类似windows里的.dll文件   
 /sbin 系统管理命令，这里存放的是系统管理员使用的管理程序   
 /tmp 公用的临时文件存储点   
 /root 系统管理员的主目录（呵呵，特权阶级）   
 /mnt 系统提供这个目录是让用户临时挂载其他的文件系统。   
 /lost+found 这个目录平时是空的，系统非正常关机而留下“无家可归”的文件（windows下叫什么.chk）就在这里   
 /proc 虚拟的目录，是系统内存的映射。可直接访问这个目录来获取系统信息。   
 /var 某些大文件的溢出区，比方说各种服务的日志文件   
 /usr 最庞大的目录，要用到的应用程序和文件几乎都在这个目录。其中包含：    
 /usr/x11r6 存放x window的目录   
 /usr/bin 众多的应用程序   
 /usr/sbin 超级用户的一些管理程序   
 /usr/doc linux文档   
 /usr/include linux下开发和编译应用程序所需要的头文件   
 /usr/lib 常用的动态链接库和软件包的配置文件   
 /usr/man 帮助文档   
 /usr/src 源代码，linux内核的源代码就放在/usr/src/linux里   
 /usr/local/bin 本地增加的命令   
 /usr/local/lib 本地增加的库根文件系统
 : /opt 主机额外安装软件所摆放的目录。
</code></pre>

<h3 id="scp">scp</h3>

<pre><code>scp （-r（目录））文件 用户名@主机名：目录
</code></pre>

<h3 id="whereis-which">whereis&amp;which</h3>

<p>whereis  软件名   &ndash;&gt;查看软件安装路径</p>

<p>which  软件名     &ndash;&gt;软件软件的运行路径</p>

<h3 id="netstat">netstat</h3>

<p>netstat -an | grep XXXX</p>

<p>netstat -tln 查看端口使用情况，而netstat -tln | grep 8083 则是只查看端口8083的使用情况</p>

<h3 id="lsof">lsof</h3>

<p>lsof -i :8083  查看端口属于哪个程序？端口被哪个进程占用</p>

<h3 id="telnet-ping">telnet&amp;ping</h3>

<p>ping  网络层协议，是发送一个包给目标主机，目标主机接收到包再返回一个响应的包，测试网络是否通</p>

<p>telnet  ，ftp都是应用层的类似tcp的协议，但是都是明文密码登陆远程主机，而ssh也是，但是它比较安全，是密文发送的。</p>

<h3 id="useradd-passwd">useradd&amp;passwd</h3>

<blockquote>
<p>useradd –d /usr/sam -m sam</p>
</blockquote>

<p>此命令创建了一个用户sam，其中-d和-m选项用来为登录名sam产生一个主目录/usr/sam（/usr为默认的用户主目录所在的父目录）。</p>

<p>假设当前用户是sam，则下面的命令修改该用户自己的口令：</p>

<blockquote>
<p>passwd</p>
</blockquote>

<p>Old password:******</p>

<p>New password:*******</p>

<p>Re-enter new password:*******</p>

<p>如果是超级用户，可以用下列形式指定任何用户的口令：</p>

<blockquote>
<p>passwd sam</p>
</blockquote>

<p>New password:*******</p>

<p>Re-enter new password:*******</p>

<h3 id="cat">cat</h3>

<p>不看注释
cat filename | grep -v &ldquo;^#&rdquo;</p>

<h3 id="ifconfig">ifconfig</h3>

<p>显示本机的ip，这只是一个工具，可以去看对应的网卡配置文件/etc/sysconfig/network-scripts/</p>

<h3 id="命令行和界面模式">命令行和界面模式</h3>

<pre><code>vi /etc/inittab
</code></pre>

<p>对于centos6和7都是这个文件，但是表现方式不一样，重点都是run level是3则是命令行模式运行。5则是界面模式运行，前提是你安装了图型界面。</p>

<h3 id="网络设置">网络设置</h3>

<p>centos 7在/etc/sysconfig/metwork-script/下面的的ifcfg-不是lo的文件，设置其静态ip</p>

<pre><code>BOOTPROTO=&quot;static&quot;
IPADDR=192.168.56.102 #静态IP  
GATEWAY=192.168.0.1 #默认网关  
NETMASK=255.255.255.0 #子网掩码  
DNS1=114.114.114.114 #DNS 配置  
</code></pre>

<p>然后重启network</p>

<pre><code>systemctl restart network
ifconfig
</code></pre>

<p>就可以看到成功设置ip了，然后最好把开始启动设置ONBOOT=&ldquo;yes&rdquo;</p>

<h3 id="tr">tr</h3>

<p>tr命令可以对来自标准输入的字符进行替换、压缩和删除。它可以将一组字符变成另一组字符，经常用来编写优美的单行命令，作用很强大。</p>

<pre><code>-c或——complerment：取代所有不属于第一字符集的字符；
-d或——delete：删除所有属于第一字符集的字符；
-s或--squeeze-repeats：把连续重复的字符以单独一个字符表示；
-t或--truncate-set1：先删除第一字符集较第二字符集多出的字符。
</code></pre>

<p>实例：</p>

<p>大小写转化</p>

<pre><code>echo &quot;HELLO WORLD&quot; | tr 'A-Z' 'a-z'
hello world
</code></pre>

<p>删除数字，是可以用范围的。</p>

<pre><code>echo &quot;hello 123 world 456&quot; | tr -d '0-9' 
hello world 
</code></pre>

<p>将制表符转换为空格</p>

<pre><code>cat text | tr '\t' ' '
</code></pre>

<h3 id="cat-1">cat</h3>

<p>cat -A filename      &mdash;-show all,用于查看是否有乱码</p>

<h3 id="sort">sort</h3>

<p>cat finenema | sort &mdash;-排序</p>

<h3 id="find">find</h3>

<pre><code>-type：根据不同的文件类型筛选
f普通文件
d目录文件
l符号链接文件
b块设备 文件
c字符设备文件
p管道文件
s套接字文件



处理动作：
　　　　　　　　　　-print：输出至标准输出；默认的动作；
　　　　　　　　　　-ls：类似于对查找到的文件执行“ls -l”命令，输出文件的详细信息；
　　　　　　　　　　-delete：删除查找到的文件；
　　　　　　　　　　-fls /PATH/TO/SOMEFILE：把查找到的所有文件的长格式信息保存至指定文件中；
　　　　　　　　　　-ok COMMAND {} \; ：对查找到的每个文件执行由COMMAND表示的命令；每次操作都由用户进行确认；
　　　　　　　　　　-exec COMMAND {} \; ：对查找到的每个文件执行由COMMAND表示的命令；
</code></pre>

<h3 id="cut">cut</h3>

<pre><code>cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段写至标准输出。
如果不指定 File 参数，cut 命令将读取标准输入。必须指定 -b、-c 或 -f 标志之一。

主要参数
-b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。
-c ：以字符为单位进行分割。
-d ：自定义分隔符，默认为制表符。
-f  ：与-d一起使用，指定显示哪个区域。
-n ：取消分割多字节字符。仅和 -b 标志一起使用。如果字符的最后一个字节落在由 -b 标志的 List 参数指示的&lt;br /&gt;范围之内，该字符将被写出；否则，该字符将被排除。
</code></pre>

<p>举个例子吧，当你执行ps命令时，会输出类似如下的内容：</p>

<pre><code>[rocrocket@rocrocket programming]$ who
rocrocket :0           2009-01-08 11:07
rocrocket pts/0        2009-01-08 11:23 (:0.0)
rocrocket pts/1        2009-01-08 14:15 (:0.0)
</code></pre>

<p>如果我们想提取每一行的第3个字节，就这样：</p>

<pre><code>[rocrocket@rocrocket programming]$ who|cut -b 3
c
c
c
</code></pre>

<h3 id="ssh">ssh</h3>

<pre><code>这边主要讲一下免密码登录，好多次都需要查找一番，决定记下来

A机器生成ssh的私钥和公钥

    ssh-keygen -t rsa

就会生成对应的私钥和公钥文件。将公钥文件id_rsa.pub上传到机器B上，注意这边最好不要直接复制容易乱码导致ssh免密码登录失败

    scp id_rsa.pub user@ip:pwd

然后就是将公钥放到B机器上的这个文件中authorized_keys

    cat id_rsa.pub &gt;&gt; authorized_keys
    chmod 600 authorized_keys

这样就可以了，同样使用于mac系统。

这边设计一个非root用户设置免密码登录的权限问题，权限太大也不行，家目录为755，.ssh的权限700， authorized_keys的权限600， 就够了，发现无法免密码登录就去查看日志/var/log/secure就知道了。
</code></pre>

<h3 id="dirname和basename">dirname和basename</h3>

<p>dirname命令可以取给定路径的目录部分（strip non-directory suffix from file name）。这个命令很少直接在shell命令行中使用，我一般把它用在shell脚本中，用于取得脚本文件所在目录，然后将当前目录切换过去。</p>

<p>basename命令则用于获取文件名</p>

<pre><code>[root@qzt196 ~]# dirname /usr/bin/sort 
/usr/bin
[root@qzt196 ~]# dirname stdio.h 
.

[root@qzt196 ~]# dirname /usr/bin 
/usr
[root@qzt196 ~]# dirname /usr/bin/ 
/usr
</code></pre>

<h3 id="uid">UID</h3>

<p>shell 的 uid/gid 則是根据 /etc/passwd 的第 3 与第 4 两位决定.</p>

<p>root 0 0</p>

<h3 id="sh">sh</h3>

<p>sh -n filename.sh    检查脚本是否正确</p>

<p>sh -x filename.sh    查看脚本执行的步骤</p>

<h3 id="ctontab">ctontab</h3>

<p>crontab -e    定时一个任务，在这个任务中编辑对应的执行时间</p>

<p>12 12 12 * * /usr/bin/bash filename.sh &gt;&gt; /tmp/mysql.log 2&gt;&amp;1</p>

<p>2&gt;$1  标准输出和标准输入都写到日志中，这边将脚本执行的日志进行重定向到/tmp/mysql.log，同时将标准输出和标准输入都写到这个文件中</p>

<h3 id="与">&amp;&amp;与；</h3>

<p>命令联合的时候</p>

<p>&amp;&amp; 前面语句执行成功才能继续执行后面的，否则退出</p>

<p>；前面的语句成功与否后面都会继续执行</p>

<h3 id="sort-1">sort</h3>

<p>sort -nr    重大到小排序</p>

<h3 id="date">date</h3>

<p>date -s 20170413  可以直接这样改变系统时间。</p>

<h3 id="hostname">hostname</h3>

<p>查看主机名，也可以直接改主机名，hostname name ,等同于修改/proc/sys/kernel/hostname文件。</p>

<h3 id="ipcs">ipcs</h3>

<p>ipcs用法</p>

<p>ipcs -a  是默认的输出信息 打印出当前系统中所有的进程间通信方式的信息</p>

<p>ipcs -m  打印出使用共享内存进行进程间通信的信息</p>

<p>ipcs -q   打印出使用消息队列进行进程间通信的信息</p>

<p>ipcs -s  打印出使用信号进行进程间通信的信息</p>

<p>ipcs -t   输出信息的详细变化时间</p>

<p>ipcs -p  输出ipc方式的进程ID</p>

<p>ipcs -c  输出ipc方式的创建者/拥有者</p>

<p>ipcrm用法
ipcrm -M shmkey  移除用shmkey创建的共享内存段</p>

<p>ipcrm -m shmid    移除用shmid标识的共享内存段</p>

<p>ipcrm -Q msgkey  移除用msqkey创建的消息队列</p>

<p>ipcrm -q msqid  移除用msqid标识的消息队列</p>

<p>ipcrm -S semkey  移除用semkey创建的信号</p>

<p>ipcrm -s semid  移除用semid标识的信号</p>

<h3 id="netstat-1">netstat</h3>

<p>netstat 不加参数持续输出</p>

<pre><code>-a (all)显示所有选项，默认不显示LISTEN相关
-t (tcp)仅显示tcp相关选项
-u (udp)仅显示udp相关选项
-n 拒绝显示别名，能显示数字的全部转化成数字。加速输出,正常都加上
-l 仅列出有在 Listen (监听) 的服務状态

-p 显示建立相关链接的程序名
-r 显示路由信息，路由表
-e 显示扩展信息，例如uid等
-s 按各个协议进行统计
-c 每隔一个固定时间，执行该netstat命令。
</code></pre>

<p>查看某个进程暂用的连接</p>

<pre><code>netstat -nap | grep pid
</code></pre>

<p>查看连接某服务端口最多的的IP地址</p>

<pre><code> netstat -nat | grep &quot;192.168.1.15:22&quot; |awk '{print $5}'|awk -F: '{print $1}'|sort|uniq -c|sort -nr|head -20
</code></pre>

<h3 id="top">top</h3>

<pre><code>top [-dpqcCSsi] [n]
</code></pre>

<p>d 指定每两次屏幕信息刷新之间的时间间隔。当然用户可以使用s交互命令来改变之。</p>

<p>p 通过指定监控进程ID来仅仅监控某个进程的状态。</p>

<p>q 该选项将使top没有任何延迟的进行刷新。如果调用程序有超级用户权限，那么top将以尽可能高的优先级运行。</p>

<p>S 指定累计模式</p>

<p>s 使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。</p>

<p>i 使top不显示任何闲置或者僵死进程。</p>

<p>c 显示整个命令行而不只是显示命令名</p>

<p>这些参数也可以在top界面操作。</p>

<p>常用操作</p>

<pre><code>top   //每隔5秒显式所有进程的资源占用情况
top -d 2  //每隔2秒显式所有进程的资源占用情况
top -c  //每隔5秒显式进程的资源占用情况，并显示进程的命令行参数(默认只有进程名)
top -p 12345 -p 6789//每隔5秒显示pid是12345和pid是6789的两个进程的资源占用情况
top -d 2 -c -p 123456 //每隔2秒显示pid是12345的进程的资源使用情况，并显式该进程启动的命令行参数
</code></pre>

<h3 id="sysctl">sysctl</h3>

<p>linux内核通过/proc虚拟文件系统向用户导出内核信息，用户也可以通过/proc文件系统或通过sysctl命令动态配置内核。比如，如果我们想启动NAT，除了加载模块、配置防火墙外，还需要启动内核转发功能。我们有三种方法：</p>

<ol>
<li><p>直接写/proc文件系统</p>

<p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p></li>

<li><p>利用sysctl命令</p>

<p>sysctl -w net.ipv4.ip_forward=1</p></li>
</ol>

<p>sysctl -a可以查看内核所有导出的变量</p>

<ol>
<li>编辑/etc/sysctl.conf</li>
</ol>

<p>添加如下一行，这样系统每次启动后，该变量的值就是1</p>

<pre><code>net.ipv4.ip_forward = 1
</code></pre>

<p>sysctl参数</p>

<p>-w   临时改变某个指定参数的值，如         sysctl -w net.ipv4.ip_forward=1</p>

<p>-a   显示所有的系统参数</p>

<p>-p   从指定的文件加载系统参数</p>

<p>关于/etc/sysctl.conf的详解</p>

<pre><code>解释一下sysctl.conf文件中参数的意义：

file-max：这个参数表示进程可以同时打开的最大句柄数，这个参数直接限制最大并发连接数。
tcp_tw_reuse：这个参数设置为1,表示允许将TIME-WAIT状态的socket重新用于新的TCP链接。这个对服务器来说很有意义，因为服务器上总会有大量TIME-WAIT状态的连接。
tcp_keepalive_time：这个参数表示当keepalive启用时，TCP发送keepalive消息的频度。默认是7200 seconds，意思是如果某个TCP连接在idle 2小时后，内核才发起probe。若将其设置得小一点，可以更快地清理无效的连接。
tcp_fin_timeout：这个参数表示当服务器主动关闭连接时，socket保持在FIN-WAIT-2状态的最大时间。
tcp_max_tw_buckets：这个参数表示操作系统允许TIME_WAIT套接字数量的最大值，如果超过这个数字，TIME_WAIT套接字将立刻被清除并打印警告信息。默认是i180000,过多TIME_WAIT套接字会使Web服务器变慢。
tcp_max_syn_backlog：这个参数表示TCP三次握手建立阶段接受WYN请求队列的最大长度，默认1024,将其设置大一些可以使出现Nginx繁忙来不及accept新连接的情况时，Linux不至于丢失客户端发起的连接请求。
ip_local_port_range：这个参数定义了在UDP和TCP连接中本地端口的取值范围。
net.ipv4.tcp_rmem：这个参数定义了TCP接受缓存（用于TCP接收滑动窗口）的最小值，默认值，最大值。
net.ipv4.tcp_wmem：这个参数定义了TCP发送缓存（用于TCP发送滑动窗口）的最小值，默认值，最大值。
netdev_max_backlog：当网卡接收数据包的速度大于内核处理的速度时，会有一个队列保存这些数据包。这个参数表示该队列的最大值。
rmem_default：这个参数表示内核套接字接收缓存区默认的大小。
wmem_default：这个参数表示内核套接字发送缓存区默认的大小。
rmem_max：这个参数表示内核套接字接收缓存区默认的最大大小。
wmem_max：这个参数表示内核套接字发送缓存区默认的最大大小。


1、减少处于FIN-WAIT-2连接状态的时间，使系统可以处理更多的连接。
net.ipv4.tcp_fin_timeout = 2
如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间。
对端可以出错并永远不关闭连接，甚至意外当机，缺省值是60秒。
2.2 内核的通常值是180秒，你可以按这个设置，但要记住的是，即使你的机器是一个轻载的WEB服务器，也有因为大量的死套接字而内存溢出的风险，FIN-WAIT-2的危险性比FIN-WAIT-1要小，因为它最多只能吃掉1.5K内存，但是它们的生存期长些。

2、以下两参数可解决生产场景中大量连接的Web（cache）服务器中TIME_WAIT过多问题。
net.ipv4.tcp_tw_reuse = 1
表示开启重用。允许将TIME-WAIT sockets重新用于新的 TCP 连接，默认为 0 表示关闭。

3、打开TIME-WAIT套接字重用及回收功能。
net.ipv4.tcp_tw_recycle = 1
表示开启TCP连接中TIME-WAIT sockets的快速收回功能，默认为 0 ，表示关闭。

4、当keepalive起用的时候，TCP发送keepalive消息的频度，缺省是2小时，改为20分钟。
net.ipv4.tcp_keepalive_time = 600

5、允许系统打开的端口范围
net.ipv4.ip_local_port_range = 4000    65000
表示用于向外连接的端口范围。缺省情况下很小：32768到61000，改为4000到65000。

6、提高系统支持的最大SYN半连接数(默认1024)
net.ipv4.tcp_max_syn_backlog = 16384
表示SYN队列的长度，默认为1024，加大队列长度为16384，可以容纳最多等待连接的网络连接数。
[root@centos5 ~]# cat /proc/sys/net/ipv4/tcp_max_syn_backlog 
1024

7、系统同时保持TIME_WAIT套接字的最大数量
net.ipv4.tcp_max_tw_buckets = 360000
表示系统同时保持TIME_WAIT套接字的最大数量，如果超过这个数字，TIME_WAIT套接字将立刻被清除并打印警告信息。默认为180000，改为 5000。
对于Apache、Nginx等服务器，上几行的参数可以很好地减少TIME_WAIT套接字数量，但是对于Squid，效果却不大。此项参数可以控制TIME_WAIT套接字的最大数量，避免Squid服务器被大量的TIME_WAIT套接字拖死。

8、路由缓存刷新频率，当一个路由失败后多长时间跳到另一个路由，默认是300。
net.ipv4.route.gc_timeout = 100

9、在内核放弃建立连接之前发送SYN包的数量。
net.ipv4.tcp_syn_retries = 1

10、减少系统SYN连接重试次数（默认是5）
net.ipv4.tcp_synack_retries = 1
为了打开对端的连接，内核需要发送一个SYN并附带一个回应前面一个SYN的ACK。
也就是所谓三次握手中的第二次握手。这个设置决定了内核放弃连接之前发送SYN+ACK包的数量。

11、设置系统对最大跟踪的TCP连接数的限制(CentOS 5.6无此参数)
net.ipv4.ip_conntrack_max = 25000000
</code></pre>

<h2 id="lsof-1">lsof</h2>

<p>lsof（list open files）是一个列出当前系统打开文件的工具</p>

<pre><code>COMMAND：进程的名称
PID：进程标识符
USER：进程所有者
FD：文件描述符，应用程序通过文件描述符识别该文件。如cwd、txt等
TYPE：文件类型，如DIR、REG等
DEVICE：指定磁盘的名称
SIZE：文件的大小
NODE：索引节点（文件在磁盘上的标识）
NAME：打开文件的确切名称
</code></pre>

<p>常用参数：</p>

<pre><code>lsof  filename 显示打开指定文件的所有进程
lsof -a 表示两个参数都必须满足时才显示结果
lsof -c string   显示COMMAND列中包含指定字符的进程所有打开的文件
lsof -u username  显示所属user进程打开的文件
lsof -g gid 显示归属gid的进程情况
lsof +d /DIR/ 显示目录下被进程打开的文件
lsof +D /DIR/ 同上，但是会搜索目录下的所有目录，时间相对较长
lsof -d FD 显示指定文件描述符的进程
lsof -n 不将IP转换为hostname，缺省是不加上-n参数
lsof -i 用以显示符合条件的进程情况
lsof -i[46] [protocol][@hostname|hostaddr][:service|port]
</code></pre>

<p>比如查看22端口的运行情况</p>

<pre><code>lsof -i :22
</code></pre>

<p>可以用于恢复已经删除的数据，文件被删除，但是正在对其读写的进程还是会继续对其进行操作，保存在/proc下面对应的进程号下面的文件描述符中，我们可以通过这个来恢复删除的文件</p>

<p>先看有木有进程占用</p>

<pre><code>lsof | grep 文件名
</code></pre>

<p>然后将这个文件追加到原来的文件中去</p>

<pre><code>cat /proc/进程id/fd/fid &gt;&gt; 原来文件名
</code></pre>

<p>还可以用于查看指定进程的连接情况，先获取进程id</p>

<pre><code>ps -ef|grep frps
</code></pre>

<p>然后根据id来查看</p>

<pre><code>lsof -p 4721 -nP | grep TCP
</code></pre>

<p>lsof 的 -nP 参数用于将 ip 地址和端口号显示为正常的数值类型，否则可能会用别名表示。就可以看出来多少连接多少监听</p>

<h2 id="iptables">iptables</h2>

<p>查看当前规则</p>

<pre><code>iptables -L -n
</code></pre>

<p>添加指定端口到防火墙</p>

<pre><code>iptables -I INPUT -p 协议 --dport 端口号 -j ACCEPT
iptables -I INPUT -p udp --dport 161 -j ACCEPT
</code></pre>

<h2 id="tail和head">tail和head</h2>

<p>显示前几行</p>

<pre><code>head -n number  filename
</code></pre>

<p>显示后几行</p>

<pre><code>tail -n number filename
</code></pre>

<p>tail的-f参数可以不断刷新文件</p>

<h2 id="netstat和ifconfig">netstat和ifconfig</h2>

<p>安装</p>

<pre><code>yum install net-tools 
</code></pre>

<h2 id="dig">dig</h2>

<p>dns解析的命令</p>

<pre><code>dig google.com
</code></pre></div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">CATEGORIES</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="http://kingjcy.github.iocategories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">技术文章</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">TAGS</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="http://kingjcy.github.iotags/linux/">linux</a></li>
          
          <li><a href="http://kingjcy.github.iotags/shell/">shell</a></li>
          
        </ul>
      </div>
    </section>
    
    
  </footer>

</article>


    
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="http://kingjcy.github.io/post/restful/" class="list-group-item">restful架构</a>
      
      <a href="http://kingjcy.github.io/post/rbac/" class="list-group-item">rbac框架</a>
      
      <a href="http://kingjcy.github.io/post/beego/" class="list-group-item">从harbor入手beego框架</a>
      
      <a href="http://kingjcy.github.io/post/chrome-dev-tool/" class="list-group-item">chrome的开发者工具</a>
      
      <a href="http://kingjcy.github.io/post/gulp/" class="list-group-item">gulp</a>
      
      <a href="http://kingjcy.github.io/post/typescript/" class="list-group-item">typescript</a>
      
      <a href="http://kingjcy.github.io/post/web/" class="list-group-item">web</a>
      
      <a href="http://kingjcy.github.io/post/mac/" class="list-group-item">mac os</a>
      
      <a href="http://kingjcy.github.io/post/go/" class="list-group-item">go积累</a>
      
      <a href="http://kingjcy.github.io/post/kickstart/" class="list-group-item">kickstart</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
      <a href="http://kingjcy.github.iocategories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0" class="list-group-item">技术文章</a>
      
      <a href="http://kingjcy.github.iocategories/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F" class="list-group-item">人生感悟</a>
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      <a href="http://kingjcy.github.iotags/tool" class="list-group-item">tool</a>
      
      <a href="http://kingjcy.github.iotags/linux" class="list-group-item">linux</a>
      
      <a href="http://kingjcy.github.iotags/go" class="list-group-item">go</a>
      
      <a href="http://kingjcy.github.iotags/language" class="list-group-item">language</a>
      
      <a href="http://kingjcy.github.iotags/redis" class="list-group-item">redis</a>
      
      <a href="http://kingjcy.github.iotags/thought" class="list-group-item">thought</a>
      
      <a href="http://kingjcy.github.iotags/centos" class="list-group-item">centos</a>
      
      <a href="http://kingjcy.github.iotags/ceph" class="list-group-item">ceph</a>
      
      <a href="http://kingjcy.github.iotags/database" class="list-group-item">database</a>
      
      <a href="http://kingjcy.github.iotags/fs" class="list-group-item">fs</a>
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p>Copyright (c) 2017. All rights reserved.</p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

